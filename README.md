# Logseq 命令执行插件

这是一个 Logseq 插件，允许你在笔记中嵌入可执行的命令按钮，点击后可以执行预定义的系统命令。

## 功能特点

- 在笔记中嵌入可点击的命令按钮
- 支持自定义命令模板和变量替换
- 内置变量支持（如图谱路径、当前日期等）
- 用户自定义变量
- 安全的命令执行（通过独立的命令执行服务器）

## 安装方法

### 1. 安装插件

```bash
# 克隆仓库
git clone https://github.com/yourusername/logseq-exec-commond.git

# 进入目录
cd logseq-exec-commond

# 安装依赖并构建插件
./install.sh
```

### 2. 在 Logseq 中加载插件

1. 打开 Logseq
2. 点击右上角三个点 -> 设置 -> 开发者模式（打开）
3. 点击右上角三个点 -> 插件 -> 加载未打包的插件
4. 选择插件目录

### 3. 启动命令执行服务器

```bash
# 进入服务器目录
cd cmd-server

# 启动服务器
./start.sh
```

## 使用方法

### 基本用法

1. 在编辑模式下，输入斜线命令 `/ExecCommand`
2. 插件会在光标位置插入一个命令按钮
3. 点击按钮执行预定义的命令

### 使用内置变量

插件支持以下内置变量：

- `${_graph_path}` - Logseq 图谱根目录路径
- `${_base_path}` - 同上，提供兼容性
- `${_date}` - 当前日期（格式可在设置中配置）

例如：

```
{{renderer :exec-command, code ${_base_path}, Open}}
```

### 自定义命令

你可以在插件设置中自定义命令模板和添加自定义变量。

## 配置选项

在 Logseq 插件设置中，你可以配置以下选项：

- **命令模板**：默认执行的命令
- **服务器URL**：命令执行服务器的地址
- **服务器Token**：用于API认证的令牌
- **用户自定义变量**：添加自己的变量，可在命令中使用

## 命令执行服务器

为了安全地执行系统命令，插件使用独立的命令执行服务器。服务器提供以下功能：

- 命令白名单过滤
- Token 认证
- 命令执行超时控制
- 输出大小限制
- 详细的日志记录

### 服务器管理

```bash
# 启动服务器
cd cmd-server
./start.sh

# 停止服务器
./stop.sh
```

## 安全注意事项

- 命令执行服务器应该只在本地运行
- 建议配置命令白名单，限制可执行的命令
- 不要在公共网络上暴露命令执行服务器
- 定期更新服务器 Token

## 许可证

MIT